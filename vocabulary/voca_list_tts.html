<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>전체 단어장</title>
    <!-- 1. Tailwind CSS 로드 -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. Pretendard (한글/영어), Noto Sans JP (일본어) 웹 폰트 로드 -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/orioncactus/pretendard@v1.3.9/dist/web/static/pretendard.min.css" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS 설정 스크립트 (폰트 적용) -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    // 2. 폰트 적용 (Tailwind 기본 폰트 재정의)
                    fontFamily: {
                        // 'sans'를 Pretendard와 Noto Sans JP로 재정의합니다.
                        sans: ['Pretendard', 'Noto Sans JP', '-apple-system', 'BlinkMacSystemFont', 'Segoe UI', 'Roboto', 'Helvetica Neue', 'Arial', 'sans-serif'],
                    },
                },
            },
        }
    </script>
</head>
<!-- body 태그에 font-sans 클래스를 적용하여 Tailwind config가 적용되도록 함 -->
<body class="bg-gray-100 flex items-center justify-center min-h-screen font-sans p-4 sm:p-6">

    <div class="container mx-auto max-w-2xl w-full">
        <div class="bg-white rounded-2xl shadow-xl p-6 sm:p-8">
            
            <!-- 제목 [수정됨] - 버튼 추가 -->
            <div class="flex flex-wrap justify-between items-center gap-4 mb-6 border-b border-gray-200 pb-5">
                <h1 id="main-title" class="text-2xl sm:text-3xl font-bold text-gray-800">
                    전체 단어장
                </h1>
                <!-- [신규] 토글 버튼 영역 -->
                <div class="flex gap-2">
                    <button id="toggle-word-btn" class="text-xs sm:text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-3 rounded-lg transition-colors duration-200">
                        단어 가리기
                    </button>
                    <button id="toggle-meaning-btn" class="text-xs sm:text-sm bg-gray-200 hover:bg-gray-300 text-gray-700 font-semibold py-2 px-3 rounded-lg transition-colors duration-200">
                        뜻 가리기
                    </button>
                </div>
            </div>

            <!-- 단어장 테이블 -->
            <div class="overflow-y-auto max-h-[70vh] border rounded-lg"> <!-- 높이 조절 -->
                <table class="min-w-full divide-y divide-gray-200">
                    <thead class="bg-gray-50 sticky top-0">
                        <tr>
                            <th scope="col" class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                단어
                            </th>
                            <th scope="col" class="p-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">
                                뜻
                            </th>
                        </tr>
                    </thead>
                    <tbody id="wordlist-table-body" class="bg-white divide-y divide-gray-200">
                        <!-- JS로 단어장 데이터 삽입 -->
                        <tr>
                            <td colspan="2" class="p-4 text-center text-gray-500">
                                단어장을 불러오는 중입니다...
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>

        </div>
    </div>

    <script>
        const wordlistTableBody = document.getElementById('wordlist-table-body');
        const toggleWordBtn = document.getElementById('toggle-word-btn');
        const toggleMeaningBtn = document.getElementById('toggle-meaning-btn');
        
        let vocabList = []; // { word: '단어', meaning: '뜻' }
        let isWordHidden = false;
        let isMeaningHidden = false;

        // [신규] 브라우저 음성 목록 로드
        if (speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = () => window.speechSynthesis.getVoices();
        }

        /**
         * vocabulary.txt 파일 불러오기
         */
        async function loadVocabulary() {
            try {
                // 캐시 사용 안 함 (항상 새로고침)
                const response = await fetch('vocabulary.txt', { cache: 'no-store' });
                if (!response.ok) {
                    throw new Error('vocabulary.txt 파일을 불러올 수 없습니다.');
                }
                const text = await response.text();
                
                vocabList = text.split('\n')
                    .map(line => line.trim())
                    .filter(line => line.length > 0 && !line.startsWith('# ')) // # 주석 제외
                    .map(line => {
                        // 구분자를 ' - '로 사용
                        const parts = line.split(' - '); 
                        if (parts.length >= 2) {
                            const word = parts[0].trim();
                            const meaning = parts.slice(1).join(' - ').trim(); 
                            return { word, meaning };
                        }
                        return null;
                    })
                    .filter(item => item !== null); // 형식이 맞지 않는 줄 제외
                
                // 단어장 불러오기 성공 시 테이블 표시
                displayWordList();

            } catch (error) {
                console.error(error);
                wordlistTableBody.innerHTML = `<tr><td colspan="2" class="p-4 text-center text-red-500">${error.message}</td></tr>`;
            }
        }

        /**
         * [신규] 단어장 테이블 표시 (DOM 생성 방식으로 변경)
         */
        function displayWordList() {
            wordlistTableBody.innerHTML = ''; // 기존 '로딩 중...' 메시지 초기화
            
            if (vocabList.length === 0) {
                wordlistTableBody.innerHTML = `<tr><td colspan="2" class="p-4 text-center text-gray-500">단어장이 비어있습니다.</td></tr>`;
                return;
            }

            // vocabList 순서대로 순회하며 테이블 채우기
            vocabList.forEach(item => {
                const { word, meaning } = item;
                
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';

                // --- 1. 단어 Cell (Word Cell) ---
                const wordCell = document.createElement('td');
                // [수정됨] 클래스에서 'text-base' 등 제거 (컨테이너가 관리)
                wordCell.className = 'p-3 text-gray-900 word-cell'; 

                // [신규] 단어 + 버튼을 담을 Flex 컨테이너
                const wordContainer = document.createElement('div');
                wordContainer.className = 'flex items-center justify-between';

                // 단어 텍스트 (span으로 감싸서 가리기 기능 적용)
                const wordSpan = document.createElement('span');
                wordSpan.className = 'word-span text-base'; // [수정됨] 폰트 크기 여기서 지정
                wordSpan.textContent = word;
                if (isWordHidden) {
                    wordSpan.classList.add('text-transparent', 'select-none');
                }

                // [신규] TTS 버튼
                const ttsButton = document.createElement('button');
                ttsButton.className = 'flex-shrink-0 w-6 h-6 rounded-full flex items-center justify-center text-gray-400 hover:bg-gray-200 hover:text-gray-700 transition-colors ml-2';
                // 스피커 아이콘 SVG
                ttsButton.innerHTML = `<svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.536 8.464a5 5 0 010 7.072m2.828-9.9a9 9 0 010 12.728M5.586 15H4a1 1 0 01-1-1v-4a1 1 0 011-1h1.586l4.707-4.707a1 1 0 011.707.707v14.586a1 1 0 01-1.707.707L5.586 15z"></path></svg>`;
                
                // [신규] TTS 이벤트 바인딩
                const lang = detectLang(word);
                ttsButton.onclick = (e) => {
                    e.stopPropagation(); // 행 클릭 이벤트 방지
                    speakWord(word, lang);
                };
                
                // 단어 셀 조립
                wordContainer.appendChild(wordSpan);
                wordContainer.appendChild(ttsButton);
                wordCell.appendChild(wordContainer);

                // --- 2. 뜻 Cell (Meaning Cell) ---
                const meaningCell = document.createElement('td');
                meaningCell.className = 'p-3 text-gray-700 meaning-cell';

                // 뜻 텍스트 (span으로 감싸서 가리기 기능 적용)
                const meaningSpan = document.createElement('span');
                meaningSpan.className = 'meaning-span text-sm'; // [수정됨] 폰트 크기 여기서 지정
                meaningSpan.textContent = meaning;
                if (isMeaningHidden) {
                    meaningSpan.classList.add('text-transparent', 'select-none');
                }
                
                // 뜻 셀 조립
                meaningCell.appendChild(meaningSpan);

                // --- 3. 행 조립 ---
                row.appendChild(wordCell);
                row.appendChild(meaningCell);
                wordlistTableBody.appendChild(row);
            });
        }
        
        // 페이지 로드 시 단어장 불러오기
        loadVocabulary();

        /**
         * [신규] 언어 감지 함수
         */
        function detectLang(text) {
            if (/[\uAC00-\uD7AF]/.test(text)) { // 한글
                return 'ko-KR';
            }
            if (/[\u3040-\u309F\u30A0-\u30FF\u4E00-\u9FAF]/.test(text)) { // 일본어 (히라가나, 가타카나, CJK 한자)
                return 'ja-JP';
            }
            // 그 외 (라틴 문자 등)는 영어로 기본 설정
            return 'en-US';
        }

        /**
         * [신규] TTS로 단어 읽기
         */
        function speakWord(word, lang) {
            // 진행 중인 음성 중지
            window.speechSynthesis.cancel();
            
            const utterance = new SpeechSynthesisUtterance(word);
            utterance.lang = lang;
            utterance.rate = 0.9; // 약간 느린 배속으로 설정

            // 해당 언어의 사용 가능한 음성 찾기
            const voices = window.speechSynthesis.getVoices();
            const specificVoice = voices.find(voice => voice.lang === lang);
            if (specificVoice) {
                utterance.voice = specificVoice;
            }
            
            window.speechSynthesis.speak(utterance);
        }

        // [수정됨] 단어 가리기 토글 (span 대상)
        toggleWordBtn.addEventListener('click', () => {
            isWordHidden = !isWordHidden;
            const spans = document.querySelectorAll('.word-span'); // [수정] .word-cell -> .word-span
            spans.forEach(span => {
                span.classList.toggle('text-transparent', isWordHidden);
                span.classList.toggle('select-none', isWordHidden);
            });
            toggleWordBtn.textContent = isWordHidden ? '단어 보이기' : '단어 가리기';
        });

        // [수정됨] 뜻 가리기 토글 (span 대상)
        toggleMeaningBtn.addEventListener('click', () => {
            isMeaningHidden = !isMeaningHidden;
            const spans = document.querySelectorAll('.meaning-span'); // [수정] .meaning-cell -> .meaning-span
            spans.forEach(span => {
                span.classList.toggle('text-transparent', isMeaningHidden);
                span.classList.toggle('select-none', isMeaningHidden);
            });
            toggleMeaningBtn.textContent = isMeaningHidden ? '뜻 보이기' : '뜻 가리기';
        });
    </script>
</body>
</html>

